import { describe, expect, test } from 'vitest';
import { parseE164, prettyE164 } from '../phone-numbers';

describe(`parseE164()`, () => {
  const cases: Array<[string | undefined, string | null]> = [
    [`+1 (555) 555-5555`, `+15555555555`],
    [`+1 (555)     555 (5555)`, `+15555555555`],
    [`(555) 555-5555`, `+15555555555`],
    [`5555555555`, `+15555555555`],
    [`+35555555555`, `+35555555555`],
    [`+35555555555  `, `+35555555555`],
    [`   +35555555555`, `+35555555555`],
    [` \t  +35555555555`, `+35555555555`],
    [`1234567`, `+1234567`], // shortest
    [`123456`, null],
    [`+123456`, null],
    [`123456789012345`, `+123456789012345`], // longest
    [`+123456789012345`, `+123456789012345`],
    [`+123(456)78-9-012345`, `+123456789012345`],
    [`1234567890123456`, null], // too long
    [`+1234567890123456`, null],
    [undefined, null],
    // UK (+44) - should strip trunk prefix 0
    [`+44 07700 900123`, `+447700900123`],
    [`+44 (0) 7700 900123`, `+447700900123`],
    [`+44 (0)7700 900123`, `+447700900123`],
    [`+4407700900123`, `+447700900123`],
    [`+44 020 7946 0958`, `+442079460958`],
    [`+44 (0) 20 7946 0958`, `+442079460958`],
    [`+44 (0)20 7946 0958`, `+442079460958`],
    [`+442079460958`, `+442079460958`],
    // France (+33) - strip trunk prefix 0
    [`+33 01 42 86 82 00`, `+33142868200`],
    [`+33 (0)1 42 86 82 00`, `+33142868200`],
    [`+330142868200`, `+33142868200`],
    // Germany (+49) - strip trunk prefix 0
    [`+49 030 12345678`, `+493012345678`],
    [`+49 (0)30 12345678`, `+493012345678`],
    [`+4903012345678`, `+493012345678`],
    // Japan (+81) - strip trunk prefix 0
    [`+81 03 1234 5678`, `+81312345678`],
    [`+81 (0)3 1234 5678`, `+81312345678`],
    [`+810312345678`, `+81312345678`],
    // Italy (+39) - trunk prefix 0 is INCLUDED in E.164 format (not stripped)
    [`+39 06 1234 5678`, `+390612345678`],
    [`+39 (0)6 1234 5678`, `+390612345678`],
    [`+390612345678`, `+390612345678`],
  ];
  test.each(cases)(`%s to I.164 -> %s`, (input, expected) => {
    expect(parseE164(input)).toBe(expected);
  });
});

describe(`prettyE164()`, () => {
  const cases: Array<[string, string]> = [
    [`+15555555555`, `(555) 555-5555`],
    [`+1555555555`, `+1555555555`],
    [`+25555555555`, `+25555555555`],
  ];
  test.each(cases)(`%s to pretty -> %s`, (input, expected) => {
    expect(prettyE164(input)).toBe(expected);
  });
});
